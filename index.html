<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title></title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="2685.2">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica}
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica; min-height: 14.0px}
  </style>
</head>
<body>
<p class="p1">&lt;!doctype html&gt;</p>
<p class="p1">&lt;html lang="zh-CN"&gt;</p>
<p class="p1">&lt;head&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;meta charset="utf-8" /&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;meta name="viewport" content="width=device-width,initial-scale=1" /&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;title&gt;打字雨 Typing Rain&lt;/title&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;style&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>html, body { height: 100%; margin: 0; background:#0b1020; color:#e8ecff; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "PingFang SC", "Microsoft YaHei", Arial; }</p>
<p class="p1"><span class="Apple-converted-space">    </span>#wrap { display:flex; flex-direction:column; height:100%; }</p>
<p class="p1"><span class="Apple-converted-space">    </span>header {</p>
<p class="p1"><span class="Apple-converted-space">      </span>display:flex; align-items:center; justify-content:space-between;</p>
<p class="p1"><span class="Apple-converted-space">      </span>padding:12px 16px; border-bottom:1px solid rgba(255,255,255,.08);</p>
<p class="p1"><span class="Apple-converted-space">      </span>background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,0));</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>.left { display:flex; gap:10px; align-items:center; }</p>
<p class="p1"><span class="Apple-converted-space">    </span>.pill {</p>
<p class="p1"><span class="Apple-converted-space">      </span>padding:6px 10px; border:1px solid rgba(255,255,255,.12);</p>
<p class="p1"><span class="Apple-converted-space">      </span>border-radius:999px; background:rgba(255,255,255,.06);</p>
<p class="p1"><span class="Apple-converted-space">      </span>font-size:13px;</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>.btn {</p>
<p class="p1"><span class="Apple-converted-space">      </span>cursor:pointer; user-select:none;</p>
<p class="p1"><span class="Apple-converted-space">      </span>padding:8px 12px; border-radius:10px;</p>
<p class="p1"><span class="Apple-converted-space">      </span>border:1px solid rgba(255,255,255,.14);</p>
<p class="p1"><span class="Apple-converted-space">      </span>background:rgba(255,255,255,.08);</p>
<p class="p1"><span class="Apple-converted-space">      </span>color:#e8ecff; font-weight:600;</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>.btn:hover { background:rgba(255,255,255,.12); }</p>
<p class="p1"><span class="Apple-converted-space">    </span>.btn:active { transform: translateY(1px); }</p>
<p class="p1"><span class="Apple-converted-space">    </span>main { position:relative; flex:1; overflow:hidden; }</p>
<p class="p1"><span class="Apple-converted-space">    </span>canvas { width:100%; height:100%; display:block; }</p>
<p class="p1"><span class="Apple-converted-space">    </span>#overlay {</p>
<p class="p1"><span class="Apple-converted-space">      </span>position:absolute; inset:0; display:flex; align-items:center; justify-content:center;</p>
<p class="p1"><span class="Apple-converted-space">      </span>background: rgba(0,0,0,.35); backdrop-filter: blur(4px);</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>.card {</p>
<p class="p1"><span class="Apple-converted-space">      </span>width:min(520px, calc(100% - 24px));</p>
<p class="p1"><span class="Apple-converted-space">      </span>border-radius:18px;</p>
<p class="p1"><span class="Apple-converted-space">      </span>border:1px solid rgba(255,255,255,.14);</p>
<p class="p1"><span class="Apple-converted-space">      </span>background: rgba(255,255,255,.08);</p>
<p class="p1"><span class="Apple-converted-space">      </span>box-shadow: 0 20px 80px rgba(0,0,0,.35);</p>
<p class="p1"><span class="Apple-converted-space">      </span>padding:18px;</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>.card h1 { margin:0 0 6px; font-size:22px; letter-spacing:.5px; }</p>
<p class="p1"><span class="Apple-converted-space">    </span>.card p { margin:0 0 12px; opacity:.9; line-height:1.55; }</p>
<p class="p1"><span class="Apple-converted-space">    </span>.row { display:flex; gap:10px; flex-wrap:wrap; align-items:center; }</p>
<p class="p1"><span class="Apple-converted-space">    </span>label { font-size:13px; opacity:.9; }</p>
<p class="p1"><span class="Apple-converted-space">    </span>input[type="range"] { width:180px; }</p>
<p class="p1"><span class="Apple-converted-space">    </span>kbd {</p>
<p class="p1"><span class="Apple-converted-space">      </span>padding:2px 6px; border-radius:6px;</p>
<p class="p1"><span class="Apple-converted-space">      </span>border:1px solid rgba(255,255,255,.18);</p>
<p class="p1"><span class="Apple-converted-space">      </span>background:rgba(255,255,255,.08);</p>
<p class="p1"><span class="Apple-converted-space">      </span>font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;</p>
<p class="p1"><span class="Apple-converted-space">      </span>font-size:12px;</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>footer {</p>
<p class="p1"><span class="Apple-converted-space">      </span>padding:10px 16px; border-top:1px solid rgba(255,255,255,.08);</p>
<p class="p1"><span class="Apple-converted-space">      </span>font-size:12px; opacity:.85;</p>
<p class="p1"><span class="Apple-converted-space">      </span>display:flex; justify-content:space-between; gap:12px; flex-wrap:wrap;</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>.warn { color:#ffd1d1; }</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;/style&gt;</p>
<p class="p1">&lt;/head&gt;</p>
<p class="p1">&lt;body&gt;</p>
<p class="p1">&lt;div id="wrap"&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;header&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;div class="left"&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;div class="pill"&gt;分数：&lt;span id="score"&gt;0&lt;/span&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;div class="pill"&gt;连击：&lt;span id="combo"&gt;0&lt;/span&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;div class="pill"&gt;生命：&lt;span id="life"&gt;10&lt;/span&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;div class="pill"&gt;等级：&lt;span id="level"&gt;1&lt;/span&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;div class="left"&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;button class="btn" id="pauseBtn"&gt;暂停&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;button class="btn" id="resetBtn"&gt;重开&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;/header&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;main&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;canvas id="c"&gt;&lt;/canvas&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;div id="overlay"&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;div class="card"&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;h1&gt;打字雨 Typing Rain&lt;/h1&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;p&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>字母会从天上掉下来，在落地前按下对应字母即可消除并得分。&lt;br/&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;span class="warn"&gt;注意：&lt;/span&gt;必须用英文键盘输入（A-Z），不区分大小写。</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/p&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div class="row" style="margin:10px 0 6px;"&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;label&gt;难度（掉落速度）：&lt;span id="spdLabel"&gt;1.0x&lt;/span&gt;&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;input id="speed" type="range" min="6" max="20" value="10" /&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div class="row" style="margin:0 0 14px;"&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;label&gt;密度（生成频率）：&lt;span id="rateLabel"&gt;中&lt;/span&gt;&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;input id="rate" type="range" min="200" max="900" value="520" /&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div class="row"&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;button class="btn" id="startBtn"&gt;开始&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;span class="pill"&gt;快捷键：&lt;kbd&gt;Space&lt;/kbd&gt; 暂停 / &lt;kbd&gt;R&lt;/kbd&gt; 重开&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;/main&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;footer&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;div&gt;玩法小技巧：优先打“最低”的字母，保持连击会加分。&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;div&gt;Made for you ✨&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;/footer&gt;</p>
<p class="p1">&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1">&lt;script&gt;</p>
<p class="p1">(() =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">  </span>const canvas = document.getElementById('c');</p>
<p class="p1"><span class="Apple-converted-space">  </span>const ctx = canvas.getContext('2d');</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>const overlay = document.getElementById('overlay');</p>
<p class="p1"><span class="Apple-converted-space">  </span>const startBtn = document.getElementById('startBtn');</p>
<p class="p1"><span class="Apple-converted-space">  </span>const pauseBtn = document.getElementById('pauseBtn');</p>
<p class="p1"><span class="Apple-converted-space">  </span>const resetBtn = document.getElementById('resetBtn');</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>const speedEl = document.getElementById('speed');</p>
<p class="p1"><span class="Apple-converted-space">  </span>const rateEl = document.getElementById('rate');</p>
<p class="p1"><span class="Apple-converted-space">  </span>const spdLabel = document.getElementById('spdLabel');</p>
<p class="p1"><span class="Apple-converted-space">  </span>const rateLabel = document.getElementById('rateLabel');</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>const scoreEl = document.getElementById('score');</p>
<p class="p1"><span class="Apple-converted-space">  </span>const comboEl = document.getElementById('combo');</p>
<p class="p1"><span class="Apple-converted-space">  </span>const lifeEl<span class="Apple-converted-space">  </span>= document.getElementById('life');</p>
<p class="p1"><span class="Apple-converted-space">  </span>const levelEl = document.getElementById('level');</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>let W=0, H=0, DPR=1;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>function resize() {</p>
<p class="p1"><span class="Apple-converted-space">    </span>DPR = Math.max(1, Math.min(2, window.devicePixelRatio || 1));</p>
<p class="p1"><span class="Apple-converted-space">    </span>const rect = canvas.getBoundingClientRect();</p>
<p class="p1"><span class="Apple-converted-space">    </span>W = Math.floor(rect.width * DPR);</p>
<p class="p1"><span class="Apple-converted-space">    </span>H = Math.floor(rect.height * DPR);</p>
<p class="p1"><span class="Apple-converted-space">    </span>canvas.width = W;</p>
<p class="p1"><span class="Apple-converted-space">    </span>canvas.height = H;</p>
<p class="p1"><span class="Apple-converted-space">    </span>ctx.setTransform(1,0,0,1,0,0);</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>window.addEventListener('resize', resize);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>// Game state</p>
<p class="p1"><span class="Apple-converted-space">  </span>let running = false;</p>
<p class="p1"><span class="Apple-converted-space">  </span>let paused = false;</p>
<p class="p1"><span class="Apple-converted-space">  </span>let over = false;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>let score = 0;</p>
<p class="p1"><span class="Apple-converted-space">  </span>let combo = 0;</p>
<p class="p1"><span class="Apple-converted-space">  </span>let life<span class="Apple-converted-space">  </span>= 10;</p>
<p class="p1"><span class="Apple-converted-space">  </span>let level = 1;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>let drops = [];</p>
<p class="p1"><span class="Apple-converted-space">  </span>let lastSpawn = 0;</p>
<p class="p1"><span class="Apple-converted-space">  </span>let lastTime = 0;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>// Tunables</p>
<p class="p1"><span class="Apple-converted-space">  </span>let baseSpeed = 10; // range 6-20 (mapped)</p>
<p class="p1"><span class="Apple-converted-space">  </span>let spawnEvery = 520; // ms 200-900</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>function randInt(a,b){ return Math.floor(Math.random()*(b-a+1))+a; }</p>
<p class="p1"><span class="Apple-converted-space">  </span>function randLetter(){</p>
<p class="p1"><span class="Apple-converted-space">    </span>const code = randInt(65, 90); // A-Z</p>
<p class="p1"><span class="Apple-converted-space">    </span>return String.fromCharCode(code);</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>function setLabels(){</p>
<p class="p1"><span class="Apple-converted-space">    </span>const spd = Number(speedEl.value);</p>
<p class="p1"><span class="Apple-converted-space">    </span>baseSpeed = spd;</p>
<p class="p1"><span class="Apple-converted-space">    </span>spdLabel.textContent = (spd/10).toFixed(1) + "x";</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>const r = Number(rateEl.value);</p>
<p class="p1"><span class="Apple-converted-space">    </span>spawnEvery = r;</p>
<p class="p1"><span class="Apple-converted-space">    </span>let txt = "中";</p>
<p class="p1"><span class="Apple-converted-space">    </span>if (r &lt; 360) txt = "高";</p>
<p class="p1"><span class="Apple-converted-space">    </span>else if (r &gt; 700) txt = "低";</p>
<p class="p1"><span class="Apple-converted-space">    </span>rateLabel.textContent = txt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>speedEl.addEventListener('input', setLabels);</p>
<p class="p1"><span class="Apple-converted-space">  </span>rateEl.addEventListener('input', setLabels);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>function syncHUD(){</p>
<p class="p1"><span class="Apple-converted-space">    </span>scoreEl.textContent = score;</p>
<p class="p1"><span class="Apple-converted-space">    </span>comboEl.textContent = combo;</p>
<p class="p1"><span class="Apple-converted-space">    </span>lifeEl.textContent<span class="Apple-converted-space">  </span>= life;</p>
<p class="p1"><span class="Apple-converted-space">    </span>levelEl.textContent = level;</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>function resetGame(){</p>
<p class="p1"><span class="Apple-converted-space">    </span>score = 0; combo = 0; life = 10; level = 1;</p>
<p class="p1"><span class="Apple-converted-space">    </span>drops = [];</p>
<p class="p1"><span class="Apple-converted-space">    </span>lastSpawn = 0;</p>
<p class="p1"><span class="Apple-converted-space">    </span>lastTime = 0;</p>
<p class="p1"><span class="Apple-converted-space">    </span>over = false;</p>
<p class="p1"><span class="Apple-converted-space">    </span>paused = false;</p>
<p class="p1"><span class="Apple-converted-space">    </span>running = false;</p>
<p class="p1"><span class="Apple-converted-space">    </span>overlay.style.display = 'flex';</p>
<p class="p1"><span class="Apple-converted-space">    </span>pauseBtn.textContent = '暂停';</p>
<p class="p1"><span class="Apple-converted-space">    </span>syncHUD();</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>function startGame(){</p>
<p class="p1"><span class="Apple-converted-space">    </span>if (running) return;</p>
<p class="p1"><span class="Apple-converted-space">    </span>running = true;</p>
<p class="p1"><span class="Apple-converted-space">    </span>paused = false;</p>
<p class="p1"><span class="Apple-converted-space">    </span>over = false;</p>
<p class="p1"><span class="Apple-converted-space">    </span>overlay.style.display = 'none';</p>
<p class="p1"><span class="Apple-converted-space">    </span>lastTime = performance.now();</p>
<p class="p1"><span class="Apple-converted-space">    </span>requestAnimationFrame(tick);</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>function togglePause(){</p>
<p class="p1"><span class="Apple-converted-space">    </span>if (!running || over) return;</p>
<p class="p1"><span class="Apple-converted-space">    </span>paused = !paused;</p>
<p class="p1"><span class="Apple-converted-space">    </span>pauseBtn.textContent = paused ? '继续' : '暂停';</p>
<p class="p1"><span class="Apple-converted-space">    </span>if (!paused) {</p>
<p class="p1"><span class="Apple-converted-space">      </span>lastTime = performance.now();</p>
<p class="p1"><span class="Apple-converted-space">      </span>requestAnimationFrame(tick);</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>function gameOver(){</p>
<p class="p1"><span class="Apple-converted-space">    </span>over = true;</p>
<p class="p1"><span class="Apple-converted-space">    </span>running = false;</p>
<p class="p1"><span class="Apple-converted-space">    </span>overlay.style.display = 'flex';</p>
<p class="p1"><span class="Apple-converted-space">    </span>overlay.querySelector('h1').textContent = '游戏结束';</p>
<p class="p1"><span class="Apple-converted-space">    </span>overlay.querySelector('p').innerHTML =</p>
<p class="p1"><span class="Apple-converted-space">      </span>`最终分数：&lt;b&gt;${score}&lt;/b&gt;，最高连击：&lt;b&gt;${combo}&lt;/b&gt;&lt;br/&gt;点“开始”再来一局。`;</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>function maybeLevelUp(){</p>
<p class="p1"><span class="Apple-converted-space">    </span>// 每 500 分升一级：增加速度、生成更密</p>
<p class="p1"><span class="Apple-converted-space">    </span>const newLevel = Math.floor(score / 500) + 1;</p>
<p class="p1"><span class="Apple-converted-space">    </span>if (newLevel !== level) {</p>
<p class="p1"><span class="Apple-converted-space">      </span>level = newLevel;</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>function spawnOne(){</p>
<p class="p1"><span class="Apple-converted-space">    </span>// 生成：同一时刻可能有重复字母，属于常见“打字雨”体验</p>
<p class="p1"><span class="Apple-converted-space">    </span>const ch = randLetter();</p>
<p class="p1"><span class="Apple-converted-space">    </span>const size = randInt(26, 42) * DPR;</p>
<p class="p1"><span class="Apple-converted-space">    </span>const x = randInt(20, Math.max(20, W - 20));</p>
<p class="p1"><span class="Apple-converted-space">    </span>const y = -randInt(20, 80) * DPR;</p>
<p class="p1"><span class="Apple-converted-space">    </span>const speed = ((baseSpeed / 10) * (1 + (level-1)*0.07)) * DPR; // px per frame-ish</p>
<p class="p1"><span class="Apple-converted-space">    </span>drops.push({ ch, x, y, size, speed, born: performance.now() });</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>function handleKey(k){</p>
<p class="p1"><span class="Apple-converted-space">    </span>if (over) return;</p>
<p class="p1"><span class="Apple-converted-space">    </span>if (!running) return;</p>
<p class="p1"><span class="Apple-converted-space">    </span>if (paused) return;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>const ch = (k || '').toUpperCase();</p>
<p class="p1"><span class="Apple-converted-space">    </span>if (ch.length !== 1 || ch &lt; 'A' || ch &gt; 'Z') return;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>// 找“最靠近地面”的匹配字母（更符合直觉）</p>
<p class="p1"><span class="Apple-converted-space">    </span>let idx = -1;</p>
<p class="p1"><span class="Apple-converted-space">    </span>let bestY = -Infinity;</p>
<p class="p1"><span class="Apple-converted-space">    </span>for (let i=0;i&lt;drops.length;i++){</p>
<p class="p1"><span class="Apple-converted-space">      </span>if (drops[i].ch === ch &amp;&amp; drops[i].y &gt; bestY){</p>
<p class="p1"><span class="Apple-converted-space">        </span>bestY = drops[i].y;</p>
<p class="p1"><span class="Apple-converted-space">        </span>idx = i;</p>
<p class="p1"><span class="Apple-converted-space">      </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>if (idx !== -1){</p>
<p class="p1"><span class="Apple-converted-space">      </span>const d = drops[idx];</p>
<p class="p1"><span class="Apple-converted-space">      </span>drops.splice(idx,1);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>combo += 1;</p>
<p class="p1"><span class="Apple-converted-space">      </span>const gain = Math.floor(10 + combo * 1.5 + level * 2);</p>
<p class="p1"><span class="Apple-converted-space">      </span>score += gain;</p>
<p class="p1"><span class="Apple-converted-space">      </span>maybeLevelUp();</p>
<p class="p1"><span class="Apple-converted-space">      </span>syncHUD();</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>// 小爆炸</p>
<p class="p1"><span class="Apple-converted-space">      </span>burst(d.x, d.y, d.size, true);</p>
<p class="p1"><span class="Apple-converted-space">    </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">      </span>// 打空：断连击</p>
<p class="p1"><span class="Apple-converted-space">      </span>combo = 0;</p>
<p class="p1"><span class="Apple-converted-space">      </span>syncHUD();</p>
<p class="p1"><span class="Apple-converted-space">      </span>burst(Math.random()*W, Math.random()*H*0.6, 24*DPR, false);</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>window.addEventListener('keydown', (e) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">    </span>if (e.code === 'Space') { e.preventDefault(); togglePause(); return; }</p>
<p class="p1"><span class="Apple-converted-space">    </span>if (e.key === 'r' || e.key === 'R') { resetGame(); startGame(); return; }</p>
<p class="p1"><span class="Apple-converted-space">    </span>handleKey(e.key);</p>
<p class="p1"><span class="Apple-converted-space">  </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>// 粒子</p>
<p class="p1"><span class="Apple-converted-space">  </span>let particles = [];</p>
<p class="p1"><span class="Apple-converted-space">  </span>function burst(x,y,size,good){</p>
<p class="p1"><span class="Apple-converted-space">    </span>const n = good ? 14 : 8;</p>
<p class="p1"><span class="Apple-converted-space">    </span>for (let i=0;i&lt;n;i++){</p>
<p class="p1"><span class="Apple-converted-space">      </span>const a = Math.random()*Math.PI*2;</p>
<p class="p1"><span class="Apple-converted-space">      </span>const v = (Math.random()*2 + 1) * (good ? 1.8 : 1.2) * DPR;</p>
<p class="p1"><span class="Apple-converted-space">      </span>particles.push({</p>
<p class="p1"><span class="Apple-converted-space">        </span>x, y,</p>
<p class="p1"><span class="Apple-converted-space">        </span>vx: Math.cos(a)*v,</p>
<p class="p1"><span class="Apple-converted-space">        </span>vy: Math.sin(a)*v,</p>
<p class="p1"><span class="Apple-converted-space">        </span>life: 400 + Math.random()*200,</p>
<p class="p1"><span class="Apple-converted-space">        </span>born: performance.now(),</p>
<p class="p1"><span class="Apple-converted-space">        </span>r: (Math.random()*2 + 1) * DPR,</p>
<p class="p1"><span class="Apple-converted-space">        </span>good</p>
<p class="p1"><span class="Apple-converted-space">      </span>});</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>function drawBG(t){</p>
<p class="p1"><span class="Apple-converted-space">    </span>// 星空渐变</p>
<p class="p1"><span class="Apple-converted-space">    </span>const g = ctx.createLinearGradient(0,0,0,H);</p>
<p class="p1"><span class="Apple-converted-space">    </span>g.addColorStop(0, 'rgba(18, 28, 62, 1)');</p>
<p class="p1"><span class="Apple-converted-space">    </span>g.addColorStop(1, 'rgba(9, 12, 26, 1)');</p>
<p class="p1"><span class="Apple-converted-space">    </span>ctx.fillStyle = g;</p>
<p class="p1"><span class="Apple-converted-space">    </span>ctx.fillRect(0,0,W,H);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>// 轻微噪点星点</p>
<p class="p1"><span class="Apple-converted-space">    </span>ctx.globalAlpha = 0.12;</p>
<p class="p1"><span class="Apple-converted-space">    </span>for (let i=0;i&lt;60;i++){</p>
<p class="p1"><span class="Apple-converted-space">      </span>const x = (Math.sin((t/800)+i)*0.5+0.5) * W;</p>
<p class="p1"><span class="Apple-converted-space">      </span>const y = (Math.cos((t/900)+i*1.7)*0.5+0.5) * H;</p>
<p class="p1"><span class="Apple-converted-space">      </span>ctx.beginPath();</p>
<p class="p1"><span class="Apple-converted-space">      </span>ctx.arc(x,y, (i%3+1)*DPR, 0, Math.PI*2);</p>
<p class="p1"><span class="Apple-converted-space">      </span>ctx.fillStyle = 'white';</p>
<p class="p1"><span class="Apple-converted-space">      </span>ctx.fill();</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>ctx.globalAlpha = 1;</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>function drawDrops(){</p>
<p class="p1"><span class="Apple-converted-space">    </span>for (const d of drops){</p>
<p class="p1"><span class="Apple-converted-space">      </span>// glow</p>
<p class="p1"><span class="Apple-converted-space">      </span>ctx.save();</p>
<p class="p1"><span class="Apple-converted-space">      </span>ctx.font = `${d.size}px ui-monospace, Menlo, Consolas, monospace`;</p>
<p class="p1"><span class="Apple-converted-space">      </span>ctx.textAlign = 'center';</p>
<p class="p1"><span class="Apple-converted-space">      </span>ctx.textBaseline = 'middle';</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>ctx.shadowColor = 'rgba(120, 170, 255, .55)';</p>
<p class="p1"><span class="Apple-converted-space">      </span>ctx.shadowBlur = 18 * DPR;</p>
<p class="p1"><span class="Apple-converted-space">      </span>ctx.fillStyle = 'rgba(232, 236, 255, .96)';</p>
<p class="p1"><span class="Apple-converted-space">      </span>ctx.fillText(d.ch, d.x, d.y);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>ctx.restore();</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>function drawGround(){</p>
<p class="p1"><span class="Apple-converted-space">    </span>const h = 6*DPR;</p>
<p class="p1"><span class="Apple-converted-space">    </span>const y = H - h;</p>
<p class="p1"><span class="Apple-converted-space">    </span>ctx.fillStyle = 'rgba(255,255,255,.08)';</p>
<p class="p1"><span class="Apple-converted-space">    </span>ctx.fillRect(0, y, W, h);</p>
<p class="p1"><span class="Apple-converted-space">    </span>ctx.fillStyle = 'rgba(120,170,255,.28)';</p>
<p class="p1"><span class="Apple-converted-space">    </span>ctx.fillRect(0, y, W, 1*DPR);</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>function drawParticles(now){</p>
<p class="p1"><span class="Apple-converted-space">    </span>particles = particles.filter(p =&gt; (now - p.born) &lt; p.life);</p>
<p class="p1"><span class="Apple-converted-space">    </span>for (const p of particles){</p>
<p class="p1"><span class="Apple-converted-space">      </span>const age = (now - p.born);</p>
<p class="p1"><span class="Apple-converted-space">      </span>const k = 1 - age / p.life;</p>
<p class="p1"><span class="Apple-converted-space">      </span>p.x += p.vx;</p>
<p class="p1"><span class="Apple-converted-space">      </span>p.y += p.vy;</p>
<p class="p1"><span class="Apple-converted-space">      </span>p.vy += 0.02*DPR; // gravity</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>ctx.globalAlpha = 0.8 * k;</p>
<p class="p1"><span class="Apple-converted-space">      </span>ctx.beginPath();</p>
<p class="p1"><span class="Apple-converted-space">      </span>ctx.arc(p.x, p.y, p.r, 0, Math.PI*2);</p>
<p class="p1"><span class="Apple-converted-space">      </span>ctx.fillStyle = p.good ? 'rgba(140, 200, 255, 1)' : 'rgba(255, 170, 170, 1)';</p>
<p class="p1"><span class="Apple-converted-space">      </span>ctx.fill();</p>
<p class="p1"><span class="Apple-converted-space">      </span>ctx.globalAlpha = 1;</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>function tick(now){</p>
<p class="p1"><span class="Apple-converted-space">    </span>if (!running || paused) return;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>const dt = Math.min(32, now - lastTime); // ms</p>
<p class="p1"><span class="Apple-converted-space">    </span>lastTime = now;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>// spawn</p>
<p class="p1"><span class="Apple-converted-space">    </span>lastSpawn += dt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>const effectiveEvery = Math.max(140, spawnEvery - (level-1)*18); // level越高越密</p>
<p class="p1"><span class="Apple-converted-space">    </span>while (lastSpawn &gt;= effectiveEvery){</p>
<p class="p1"><span class="Apple-converted-space">      </span>lastSpawn -= effectiveEvery;</p>
<p class="p1"><span class="Apple-converted-space">      </span>spawnOne();</p>
<p class="p1"><span class="Apple-converted-space">      </span>if (Math.random() &lt; 0.12 + level*0.01) spawnOne(); // 偶尔双发</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>// update</p>
<p class="p1"><span class="Apple-converted-space">    </span>const fall = (dt / 16.67); // frame factor</p>
<p class="p1"><span class="Apple-converted-space">    </span>for (const d of drops){</p>
<p class="p1"><span class="Apple-converted-space">      </span>d.y += d.speed * fall * 6.2; // 调一调手感</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>// hit ground</p>
<p class="p1"><span class="Apple-converted-space">    </span>const groundY = H - 6*DPR;</p>
<p class="p1"><span class="Apple-converted-space">    </span>let missed = 0;</p>
<p class="p1"><span class="Apple-converted-space">    </span>drops = drops.filter(d =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">      </span>if (d.y &gt;= groundY){</p>
<p class="p1"><span class="Apple-converted-space">        </span>missed++;</p>
<p class="p1"><span class="Apple-converted-space">        </span>burst(d.x, groundY, 22*DPR, false);</p>
<p class="p1"><span class="Apple-converted-space">        </span>return false;</p>
<p class="p1"><span class="Apple-converted-space">      </span>}</p>
<p class="p1"><span class="Apple-converted-space">      </span>return true;</p>
<p class="p1"><span class="Apple-converted-space">    </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>if (missed &gt; 0){</p>
<p class="p1"><span class="Apple-converted-space">      </span>life -= missed;</p>
<p class="p1"><span class="Apple-converted-space">      </span>combo = 0;</p>
<p class="p1"><span class="Apple-converted-space">      </span>if (life &lt;= 0){</p>
<p class="p1"><span class="Apple-converted-space">        </span>life = 0;</p>
<p class="p1"><span class="Apple-converted-space">        </span>syncHUD();</p>
<p class="p1"><span class="Apple-converted-space">        </span>render(now);</p>
<p class="p1"><span class="Apple-converted-space">        </span>gameOver();</p>
<p class="p1"><span class="Apple-converted-space">        </span>return;</p>
<p class="p1"><span class="Apple-converted-space">      </span>}</p>
<p class="p1"><span class="Apple-converted-space">      </span>syncHUD();</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>render(now);</p>
<p class="p1"><span class="Apple-converted-space">    </span>requestAnimationFrame(tick);</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>function render(now){</p>
<p class="p1"><span class="Apple-converted-space">    </span>drawBG(now);</p>
<p class="p1"><span class="Apple-converted-space">    </span>drawGround();</p>
<p class="p1"><span class="Apple-converted-space">    </span>drawDrops();</p>
<p class="p1"><span class="Apple-converted-space">    </span>drawParticles(now);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>// 小提示（暂停/未开始）</p>
<p class="p1"><span class="Apple-converted-space">    </span>if (!running &amp;&amp; !over){</p>
<p class="p1"><span class="Apple-converted-space">      </span>ctx.globalAlpha = 0.8;</p>
<p class="p1"><span class="Apple-converted-space">      </span>ctx.fillStyle = 'rgba(255,255,255,.85)';</p>
<p class="p1"><span class="Apple-converted-space">      </span>ctx.font = `${14*DPR}px ui-sans-serif, system-ui`;</p>
<p class="p1"><span class="Apple-converted-space">      </span>ctx.textAlign = 'left';</p>
<p class="p1"><span class="Apple-converted-space">      </span>ctx.fillText('点击开始，或按 Space 暂停 / R 重开', 14*DPR, 22*DPR);</p>
<p class="p1"><span class="Apple-converted-space">      </span>ctx.globalAlpha = 1;</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>// UI bindings</p>
<p class="p1"><span class="Apple-converted-space">  </span>startBtn.addEventListener('click', () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">    </span>// 恢复标题（如果上次 game over 改过）</p>
<p class="p1"><span class="Apple-converted-space">    </span>overlay.querySelector('h1').textContent = '打字雨 Typing Rain';</p>
<p class="p1"><span class="Apple-converted-space">    </span>overlay.querySelector('p').innerHTML =</p>
<p class="p1"><span class="Apple-converted-space">      </span>'字母会从天上掉下来，在落地前按下对应字母即可消除并得分。&lt;br/&gt;' +</p>
<p class="p1"><span class="Apple-converted-space">      </span>'&lt;span class="warn"&gt;注意：&lt;/span&gt;必须用英文键盘输入（A-Z），不区分大小写。';</p>
<p class="p1"><span class="Apple-converted-space">    </span>setLabels();</p>
<p class="p1"><span class="Apple-converted-space">    </span>if (!running) startGame();</p>
<p class="p1"><span class="Apple-converted-space">  </span>});</p>
<p class="p1"><span class="Apple-converted-space">  </span>pauseBtn.addEventListener('click', togglePause);</p>
<p class="p1"><span class="Apple-converted-space">  </span>resetBtn.addEventListener('click', () =&gt; { resetGame(); setLabels(); render(performance.now()); });</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>// init</p>
<p class="p1"><span class="Apple-converted-space">  </span>resize();</p>
<p class="p1"><span class="Apple-converted-space">  </span>setLabels();</p>
<p class="p1"><span class="Apple-converted-space">  </span>resetGame();</p>
<p class="p1"><span class="Apple-converted-space">  </span>render(performance.now());</p>
<p class="p1">})();</p>
<p class="p1">&lt;/script&gt;</p>
<p class="p1">&lt;/body&gt;</p>
<p class="p1">&lt;/html&gt;</p>
</body>
</html>
